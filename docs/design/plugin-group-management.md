# 设计文档：用户组管理插件 (plugin-group-management)

本文档描述了“用户组管理”插件的设计与实现。该插件旨在为用户提供一个直观的界面，用于管理他们创建或加入的用户组，包括成员管理和角色权限分配。

## 1. 核心功能

该插件将实现以下核心功能：

*   **用户组管理**:
    *   创建新的用户组。
    *   查看用户所属（作为`Owner`或`Member`）的所有用户组列表。
    *   编辑用户组的基本信息（名称、描述）。
    *   删除用户组（仅限`Owner`）。
*   **成员管理**:
    *   邀请新用户加入用户组（通过邮件或用户名）。
    *   查看用户组内的成员列表及其角色。
    *   修改成员的角色。
    *   将成员从用户组中移除。
*   **角色与权限管理**:
    *   在用户组内创建自定义角色。
    *   为角色分配插件已注册的UI权限（`ui.*`）和数据库权限（`db.*`）。
    *   编辑和删除组内自定义的角色。

## 2. UI 设计与页面结构

插件将主要由以下几个页面和核心组件构成，并集成到后台管理布局中。

### 2.1 页面路由

*   `/admin/groups`: **用户组列表页**。默认页面，展示用户相关的所有组。
*   `/admin/groups/:groupId`: **用户组详情页**。展示特定组的详细信息，并包含成员管理和角色管理的Tab。
*   `/admin/groups/new`: **创建用户组页**。一个简单的表单，用于创建新组。

### 2.2 核心页面与组件

*   **GroupListPage (`/admin/groups`)**:
    *   使用卡片或列表形式展示用户组。
    *   每个条目显示组名、用户在组内的角色（Owner/Member）和成员数量。
    *   提供一个“创建新组”的按钮，导航到 `/admin/groups/new`。此按钮将依赖 `ui.group.create` 权限。
    *   提供快速入口，点击可进入组详情页 `/admin/groups/:groupId`。

*   **GroupDetailsPage (`/admin/groups/:groupId`)**:
    *   页面顶部显示用户组的名称和描述，并提供依赖 `ui.group.edit` 权限的“编辑”操作和依赖 `ui.group.delete` 权限的“删除”操作。
    *   使用Tab组件来组织不同的管理功能：
        *   **Members Tab**:
            *   展示成员列表，包含头像、用户名和角色。
            *   提供“邀请成员”按钮，该按钮依赖 `ui.group.members.invite` 权限。
            *   允许`Owner`修改成员的角色或将其移除（依赖 `ui.group.members.remove` 权限）。
        *   **Roles Tab**:
            *   展示该组内可用的角色列表（包括系统预设的`Owner`, `Member`和自定义角色）。
            *   提供“创建角色”按钮，依赖 `ui.group.roles.create` 权限。
            *   允许`Owner`编辑（依赖 `ui.group.roles.edit` 权限）或删除（依赖 `ui.group.roles.delete` 权限）自定义角色。
        *   **Settings Tab**:
            *   提供编辑组基本信息（名称、描述）的表单。
            *   提供删除用户组的危险操作区域。

## 3. 插件集成 (Plugin Registration)

插件将通过 `src/plugins/group-management/index.js` 文件注册到框架中。注册过程主要包括以下几个步骤：

1.  **注册国际化资源**: 为插件定义 `group-management` 的 i18n 命名空间，并提供中英文翻译。
2.  **注册后台路由**: 注册 `/admin/groups`, `/admin/groups/:groupId` 等页面路由。
3.  **注册后台管理菜单**: 在后台侧边栏添“用户组管理”菜单项。
4.  **注册权限点**: 声明插件UI功能所需的权限点，以便在角色管理中进行分配。这些权限点的显示和隐藏将由前端根据用户的权限动态控制。
    *   `ui.group.create`: 控制“创建新组”按钮的显示。
    *   `ui.group.delete`: 控制“删除用户组”按钮的显示。
    *   `ui.group.edit`: 控制“编辑用户组信息”功能的可用性。
    *   `ui.group.members.invite`: 控制“邀请成员”按钮的显示。
    *   `ui.group.members.remove`: 控制“移除成员”功能的可用性。
    *   `ui.group.roles.create`: 控制“创建角色”按钮的显示。
    *   `ui.group.roles.edit`: 控制“编辑角色”功能的可用性。
    *   `ui.group.roles.delete`: 控制“删除角色”功能的可用性。

## 4. 数据库与后端交互

根据框架的权限设计，前端可以直接通过Supabase的JavaScript客户端与数据库表进行交互。所有的数据访问都将受到行级安全（RLS）策略的保护。

例如，获取用户组列表可以直接查询 `groups` 表，RLS策略将确保只返回当前用户有权访问的组。同样，创建、更新或删除操作也将由相应的RLS策略进行验证，确保用户拥有执行这些操作的权限（例如，只有组的`Owner`才能删除该组）。

这种设计简化了后端逻辑，无需为每个操作编写单独的RPC函数，同时保持了数据的安全性。

## 5. 开发计划与步骤

1.  **创建插件基础结构**: 建立 `src/plugins/group-management` 目录，包含`index.js`, `i18n`, `pages`, `components` 等子目录。
2.  **实现UI骨架**: 开发`GroupListPage`和`GroupDetailsPage`的静态布局。
3.  **数据联调**: 将前端页面与Supabase表直接对接，实现用户组的展示和基本管理。
4.  **实现成员管理**: 开发成员邀请、移除和角色修改功能。
5.  **实现角色管理**: 开发组内角色创建、编辑和删除功能，包括权限选择界面。
6.  **完善与测试**: 进行全面的功能测试，并优化UI/UX细节。